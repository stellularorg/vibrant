{% extends "../../base.html" %}

{% block title %}{{ file_path }} - {{ project.name }}{% endblock %}
{% block toolbar_stuff %}style="display: none !important;"{% endblock %}

{% block content %}
<div class="flex flex-column" style="height: 100dvh;">
    <div class="panes flex mobile:flex-column" style="height: 100%; overflow: auto;">
        <div id="_doc" class="full" style="height: 100%; overflow: auto; display: block;"></div>

        <div id="_preview_browser" class="full" style="height: 100%; overflow: hidden; display: none;">
            <div class="full flex g-4 bg-0" style="padding: var(--u-04); height: 47.8px;">
                <button class="round" id="preview" title="Refresh Preview">
                    <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-refresh-cw">
                        <path d="M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8" />
                        <path d="M21 3v5h-5" />
                        <path d="M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16" />
                        <path d="M8 16H3v5" />
                    </svg>
                </button>

                <button class="round" data-dialog="workspace_settings" title="Workspace Settings">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-settings-2">
                        <path d="M20 7h-9" />
                        <path d="M14 17H5" />
                        <circle cx="17" cy="17" r="3" />
                        <circle cx="7" cy="7" r="3" />
                    </svg>
                </button>
            </div>

            <iframe id="_preview_pane" class="full" style="height: calc(100% - 47.8px); overflow: auto;" frameborder="0"
                src="about:blank"></iframe>
        </div>

        <style>
            #_preview_pane {
                background: white;
            }

            #_preview_browser {
                border-left: solid 1px var(--background-surface2a);
            }

            @media screen and (max-width: 900px) {
                #_preview_browser {
                    border-left: 0;
                    border-top: solid 1px var(--background-surface2a);
                }
            }
        </style>
    </div>

    <div class="card secondary flex mobile:justify-center justify-space-between align-center" style="
        overflow: auto hidden;
        border-top: 1px solid var(--background-surface2a);
        padding: var(--u-04);
        height: 47.8px;
    ">
        <b style="min-width: max-content;" class="device:desktop">{{ file_path }}</b>

        <div class="flex g-4">
            <button class="round secondary green" id="save" title="Save File">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-save">
                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z" />
                    <polyline points="17 21 17 13 7 13 7 21" />
                    <polyline points="7 3 7 8 15 8" />
                </svg>
            </button>

            <a href="/dashboard/project/{{ project.name }}" class="button round secondary" id="file_explorer"
                title="Manage Files">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-folder-tree">
                    <path
                        d="M20 10a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-2.5a1 1 0 0 1-.8-.4l-.9-1.2A1 1 0 0 0 15 3h-2a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z" />
                    <path
                        d="M20 21a1 1 0 0 0 1-1v-3a1 1 0 0 0-1-1h-2.9a1 1 0 0 1-.88-.55l-.42-.85a1 1 0 0 0-.92-.6H13a1 1 0 0 0-1 1v5a1 1 0 0 0 1 1Z" />
                    <path d="M3 5a2 2 0 0 0 2 2h3" />
                    <path d="M3 3v13a2 2 0 0 0 2 2h3" />
                </svg>
            </a>

            <div class="hr-left"></div>

            <button class="round secondary red" id="split_view" title="Split View">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-columns-2">
                    <rect width="18" height="18" x="3" y="3" rx="2" />
                    <path d="M12 3v18" />
                </svg>
            </button>
        </div>
    </div>

    <script type="module">
        import { create_editor } from "/static/js/FileEditor.js";
        create_editor(document.getElementById('_doc'), '{{ project.name }}', '{{ file_path }}');
        globalThis.FileEditor.Update(`{{ file_content|safe }}`)
    </script>

    <style>
        .cm-editor,
        .cm-line,
        .cm-line span {
            font-family: monospace !important;
        }

        .toolbar-layout-wrapper {
            max-height: 100dvh !important;
        }
    </style>
</div>

<!-- dialogs -->
<dialog id="workspace_settings">
    <div style="width: 25rem; max-width: 100%">
        <h2 class="no-margin full text-center" style="cursor: pointer">
            Workspace
        </h2>

        <hr />

        <div class="flex flex-column g-4">
            <div class="card full round secondary flex justify-space-between align-center">
                <label for="visual_editor"><b>Visual Editor</b></label>
                <input type="checkbox" name="visual_editor" id="visual_editor"
                    style="width: 15px; height: 15px !important;"
                    onclick="globalThis.FileEditor.visual_editor_enabled = event.checked;" />
            </div>
        </div>

        <hr />

        <div class="full flex justify-right">
            <a class="button round red" href="javascript:document.getElementById('workspace_settings').close();">
                Close
            </a>
        </div>
    </div>
</dialog>
{% endblock %}